// SPDX-License-Identifier: GPL-2.0-or-later OR MIT
/* Copyright (c) 2019, Robert Marko <robimarko@gmail.com> */

#include "qcom-ipq4019-ap.dk04.1.dtsi"
#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/input/input.h>
#include <dt-bindings/soc/qcom,tcsr.h>

/ {
	model = "Linkesys WHW03 (Velop)";
	compatible = "linksys,whw03";

	aliases {
		led-boot = &led_status;
		led-failsafe = &led_status;
		led-running = &led_status;
		led-upgrade = &led_upgrade;
	};

	chosen {
                bootargs-append = " rootfstype=ext4 root=/dev/mmcblk0p17 rootwait console=ttyMSM0,115200n8";
        };

	memory {
		device_type = "memory";
		reg = <0x80000000 0x10000000>;
	};

	soc {
		mdio@90000 {
			status = "okay";

			pinctrl-0 = <&mdio_pins>;
			pinctrl-names = "default";
		};


		counter@4a1000 {
			compatible = "qcom,qca-gcnt";
			reg = <0x4a1000 0x4>;
		};

		tcsr@1949000 {
			compatible = "qcom,tcsr";
			reg = <0x1949000 0x100>;
			qcom,wifi_glb_cfg = <TCSR_WIFI_GLB_CFG>;
		};

		tcsr@194b000 {
			status = "okay";

			compatible = "qcom,tcsr";
			reg = <0x194b000 0x100>;
			qcom,usb-hsphy-mode-select = <TCSR_USB_HSPHY_HOST_MODE>;
		};

		ess_tcsr@1953000 {
			compatible = "qcom,tcsr";
			reg = <0x1953000 0x1000>;
			qcom,ess-interface-select = <TCSR_ESS_PSGMII>;
		};

		tcsr@1957000 {
			compatible = "qcom,tcsr";
			reg = <0x1957000 0x100>;
			qcom,wifi_noc_memtype_m0_m2 = <TCSR_WIFI_NOC_MEMTYPE_M0_M2>;
		};


		ess-switch@c000000 {
			status = "okay";
		};

		edma@c080000 {
			status = "okay";
		};

		qcom,pcie@80000 {
			compatible = "qcom,msm_pcie";
			cell-index = <0x0>;
			qcom,ctrl-amt = <0x1>;
			reg = <0x80000 0x2000 0x99000 0x800 0x40000000 0xf1d 0x40000f20 0xa8 0x40100000 0x1000 0x40200000 0x100000 0x40300000 0xd00000>;
			reg-names = "parf", "phy", "dm_core", "elbi", "conf", "io", "bars";
			#address-cells = <0x0>;
			interrupt-parent = <0x52>;
			interrupts = <0x0 0x1 0x2 0x3 0x4 0x5 0x6 0x7 0x8 0x9 0xa 0xb 0xc>;
			#interrupt-cells = <0x1>;
			interrupt-map-mask = <0xffffffff>;
			interrupt-map = <0x0 0x1 0x0 0x8d 0x0 0x1 0x1 0x0 0x8e 0x0 0x2 0x1 0x0 0x8f 0x0 0x3 0x1 0x0 0x90 0x0 0x4 0x1 0x0 0x91 0x0 0x5 0x1 0x0 0x92 0x0 0x6 0x1 0x0 0x93 0x0 0x7 0x1 0x0 0x94 0x0 0x8 0x1 0x0 0x95 0x0 0x9 0x1 0x0 0x96 0x0 0xa 0x1 0x0 0x97 0x0 0xb 0x1 0x0 0x98 0x0>;
			interrupt-names = "int_msi", "int_a", "int_b", "int_c", "int_d", "int_pls_pme", "int_pme_legacy", "int_pls_err", "int_aer_legacy", "int_pls_link_up", "int_pls_link_down", "int_bridge_flush_n", "int_wake";
			qcom,ep-latency = <0xa>;
			clocks = <0x2 0x26 0x2 0x27 0x2 0x28>;
			clock-names = "pcie_0_cfg_ahb_clk", "pcie_0_mstr_axi_clk", "pcie_0_slv_axi_clk";
			max-clock-frequency-hz = <0x0 0x0 0x0>;
			resets = <0x2 0x1c 0x2 0x1b 0x2 0x1a 0x2 0x19 0x2 0x18 0x2 0x17 0x2 0x16 0x2 0x15 0x2 0x14 0x2 0x13 0x2 0x12 0x2 0x11>;
			reset-names = "pcie_rst_axi_m_ares", "pcie_rst_axi_s_ares", "pcie_rst_pipe_ares", "pcie_rst_axi_m_vmidmt_ares", "pcie_rst_axi_s_xpu_ares", "pcie_rst_parf_xpu_ares", "pcie_rst_phy_ares", "pcie_rst_axi_m_sticky_ares", "pcie_rst_pipe_sticky_ares", "pcie_rst_pwr_ares", "pcie_rst_ahb_res", "pcie_rst_phy_ahb_ares";
			status = "ok";
			perst-gpio = <0x50 0x26 0x0>;
			wake-gpio = <0x50 0x28 0x0>;
			clkreq-gpio = <0x50 0x27 0x0>;
			linux,phandle = <0x52>;
			phandle = <0x52>;
		};		
	};

	keys {
		compatible = "gpio-keys";

		reset {
			label = "reset";
			gpios = <&tlmm 49 GPIO_ACTIVE_HIGH>;
			linux,code = <KEY_RESTART>;
		};
	};

	leds {
		compatible = "gpio-leds";

		led_status: status {
			label = "whw03:green:status";
			gpios = <&tlmm 36 GPIO_ACTIVE_HIGH>;
			panic-indicator;
		};

		led_upgrade: upgrade {
			label = "whw03:green:upgrade";
			gpios = <&tlmm 40 GPIO_ACTIVE_HIGH>;
		};
	};
};

&vqmmc {
	status = "okay";
};

&sdhci {
	status = "okay";

	pinctrl-0 = <&sd_pins>;
	pinctrl-names = "default";
	cd-gpios = <&tlmm 53 GPIO_ACTIVE_HIGH>;
	sd-ldo-gpios = <&tlmm 21 GPIO_ACTIVE_HIGH>;
	vqmmc-supply = <&vqmmc>;
};

&tlmm {
	mdio_pins: mdio_pinmux {
		mux_1 {
			pins = "gpio6";
			function = "mdio0";
			bias-bus-hold;
		};

		mux_2 {
			pins = "gpio7";
			function = "mdc";
			bias-bus-hold;
		};
	};

	ts_pins: ts_pinmux {
		mux_1 {
			pins = "gpio34";
			output-high;
		};
		
		mux_2 {
			pins = "gpio35";
			input-enable;
			bias-pull-up;
		};
	};

	i2c_0_pins: i2c_0_pinmux {
		pinmux {
			function = "blsp_i2c0";
			pins = "gpio58", "gpio59";
			bias-disable;
		};
	};

	spi_1_pins: spi_1_pinmux {
		pinmux {
			function = "blsp_spi1";
			pins = "gpio45", "gpio47", "gpio46";
			drive-strength = <12>;
			bias-disable;
		};

		pinmux_cs {
			function = "gpio";
			pins = "gpio45";
			drive-strength = <2>;
			bias-pull-up;
		};
		pinmux_reset {
			function = "gpio";
			pins = "gpio45";
			output-high;
		};
		pinmux_host_int {
			function = "gpio";
			pins = "gpio42";
			input;
		};
	};

	led_pins: led0_pinmux {
		pinmux {
			function = "led2";
			pins = "gpio36";
			bias-pull-down;
		};
	};

	sd_pins: sd_pins {
		pinmux {
			function = "sdio";
			pins = "gpio23", "gpio24", "gpio25", "gpio26",
				"gpio29", "gpio30", "gpio31";
			drive-strength = <0xa>;
		};

		pinmux_sd_cmd {
			function = "sdio_cmd";
			pins = "gpio28";
			drive-strength = <0xa>;
		};

		pinmux_sd_clk {
			function = "sdio";
			pins = "gpio27";
			drive-strength = <0x10>;
		};

		pinmux_sd7 {
			function = "sdio";
			pins = "gpio32";
			drive-strength = <0xa>;
			bias-disable;
		};
	};

	wifi1_pins: wifi1_pinmux {
		mux_1 {
		pins = "gpio37";
		output-high;
		function = "wcss0_dbg16";
		bias-pull-up;
		drive-strength = <0x6>;
		};

		mux_2 {
		pins = "gpio43";
		function = "wifi_wci1";
		bias-pull-up;
		drive-strength = <0x6>;
		};

		mux_3 {
		pins = "gpio52";
		output-high;
		function = "gpio";
		bias-pull-up;
		drive-strength = <0x6>;
		};
	};
};

&blsp1_i2c3 {
	reg-names = "qup_phys_addr", "bam_phys_addr";
	reg = <0x78b7000 0x600 0x7884000 0x23000>;
	status = "ok";
	pinctrl-0 = <0x4f>;
	pinctrl-1 = <0x4f>;
	pinctrl-names = "i2c_active", "i2c_sleep";
	qca_codec@12 {
		compatible = "qca,ipq40xx-codec";
		reg = <0x12>;
		status = "disabled";
	};
	lcd_ts@40 {
		compatible = "qca,gsl1680_ts";
		reg = <0x40>;
		status = "disabled";
	};
	pca9633 {
		compatible = "nxp,pca9633";
		#address-cells = <0x1>;
		#size-cells = <0x0>;
		reg = <0x62>;
		nxp,hw-blink;
		red@0 {
			label = "red";
			reg = <0x0>;
			linux,default-trigger = "none";
		};
		green@1 {
			label = "green";
			reg = <0x1>;
			linux,default-trigger = "none";
		};
		blue@2 {
			label = "blue";
			reg = <0x2>;
			linux,default-trigger = "none";
		};
		unused@3 {
			label = "unused";
			reg = <0x3>;
			linux,default-trigger = "none";
		};
	};	
};

&blsp1_spi2 {
	status = "okay";

	pinctrl-0 = <&spi_1_pins>;
	pinctrl-names = "default";

	flash@0 {
		compatible = "jedec,spi-nor";
		spi-max-frequency = <24000000>;
		reg = <0>;

		partitions {
			compatible = "fixed-partitions";
			#address-cells = <1>;
			#size-cells = <1>;

			partition@22 {
				label = "SBL1";
				reg = <0x00000022 0x00000421>;
				read-only;
			};
			partition@422 {
				label = "BOOTCONFIG";
				reg = <0x00000422 0x00000821>;
				read-only;
			};
			partition@822 {
				label = "QSEE";
				reg = <0x00000822 0x00000C21>;
				read-only;
			};
			partition@c22 {
				label = "QSEE_1";
				reg = <0x00000C22 0x00001021>;
				read-only;
			};
			partition@1022 {
				label = "CDT";
				reg = <0x00001022 0x00001221>;
				read-only;
			};
			partition@1222 {
				label = "CDT_1";
				reg = <0x00001222 0x00001421>;
				read-only;
			};
			partition@1422 {
				label = "BOOTCONFIG1";
				reg = <0x00001422 0x00001621>;
				read-only;
			};
			partition@1622 {
				label = "APPSBL"; /* uboot env */
				reg = <0x00001622 0x00001E21>;
				read-only;
			};
			partition@1E22 {
				label = "APPSBL_1"; /* uboot env */
				reg = <0x00001E22 0x00002621>;
				read-only;
			};
			partition@2622 {
				label = "ART";
				reg = <0x00002622 0x00002681>;
				read-only;
			};
			partition@2822 {
				label = "u_env";
				reg = <0x00002822 0x00003021>;
				read-only;
			};
			partition@3022 {
				label = "s_env";
				reg = <0x00003022 0x00003821>;
				read-only;
			};
			partition@3822 {
				label = "devinfo";
				reg = <0x00003822 0x00004021>;
				read-only;
			};
			partition@4022 {
				label = "firmware";
				compatible = "denx,fit";
				reg = <0x00004022 0x00048021>;
			};
		};
	};
};

&nand {
	status = "disabled";
};

&blsp1_uart1 {
	status = "okay";

	pinctrl-0 = <&serial1_pins>;
	pinctrl-names = "default";
};


&wifi0 {
	status = "ok";
	qca,msi_addr = <0xb006040>;
	qca,msi_base = <0x40>;
	wifi-led-gpios = <0x50 0x14 0x1>;
	wifi-rssi-gpios = <0x50 0x15 0x1>;
	qcom,mtd-name = "0:ART";
	qcom,cal-offset = <0x1000>;
	qcom,cal-len = <0x2f20>;
	pinctrl-0 = <0x51>;
	pinctrl-names = "default";
	btcoex_support = <0x1>;
	wlan_prio_gpio = <0x34>;
};

&wifi1 {
	status = "ok";
	qca,msi_addr = <0xb006040>;
	qca,msi_base = <0x50>;
	wifi-led-gpios = <0x50 0x3f 0x1>;
	wifi-rssi-gpios = <0x50 0x40 0x1>;
	qcom,mtd-name = "0:ART";
	qcom,cal-offset = <0x5000>;
	qcom,cal-len = <0x2f20>;
	btcoex_support = <0x0>;
};
